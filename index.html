<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Controle de Nivel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 20px;
        background: #f0f0f0;
      }
      h1 {
        color: #333;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        margin: auto;
      }
      p {
        font-size: 18px;
      }
      #status {
        font-weight: bold;
      }
      form {
        margin-top: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input[type="number"] {
        width: 90%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      input[type="submit"] {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
      }
    </style>
    <script>
      // Esta função atualiza o status do nível e da bomba
      function atualizarStatus() {
        fetch("/estado")
          .then((res) => res.json())
          .then((data) => {
            document.getElementById("nivel").innerText = data.nivel + "%";
            document.getElementById("bomba").innerText = data.bomba
              ? "LIGADA"
              : "Desligada";
            document.getElementById("bomba").style.color = data.bomba
              ? "#4CAF50"
              : "#f44336";
          });
      }

      // Garante que o script rode após a página carregar
      window.onload = function () {
        atualizarStatus(); // Carrega o status inicial
        setInterval(atualizarStatus, 2000); // Define a atualização periódica

        // Adiciona o 'escutador' de eventos ao formulário para envio com AJAX
        const form = document.querySelector("form");
        form.addEventListener("submit", function (event) {
          // Impede que o formulário recarregue a página
          event.preventDefault();

          const minVal = document.getElementById("min").value;
          const maxVal = document.getElementById("max").value;

          // Envia os dados para o servidor usando fetch
          fetch(`/limites?min=${minVal}&max=${maxVal}`)
            .then((response) => {
              console.log("Limites atualizados com sucesso!");
              document.getElementById("min").value = "";
              document.getElementById("max").value = "";
            })
            .catch((error) =>
              console.error("Erro ao atualizar limites:", error)
            );
        });
      };
    </script>
  </head>
  <body>
    <div class="container">
      <h1>Controle de Nível</h1>
      <p>Nível Atual: <span id="nivel">--</span></p>
      <p>Status da Bomba: <span id="bomba">--</span></p>
      <form>
        <label for="min">Limite Mínimo (%):</label>
        <input type="number" id="min" name="min" required />
        <label for="max">Limite Máximo (%):</label>
        <input type="number" id="max" name="max" required />
        <input type="submit" value="Atualizar Limites" />
      </form>
    </div>
  </body>
</html>
